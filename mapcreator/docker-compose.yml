version: '3'
services:
  mml-client:
    image: teemupel/mml-muutostietopalvelu-client
    volumes:
      - ./mmlclient.toml:/go/src/app/mmlclient.toml
      - /opt/mtkdata/:/mtkdata
      - /opt/krkdata/:/krkdata
  mapsforge:
    image: teemupel/mapsforge
    volumes:
      - /opt/convertedpbf:/convertedpbf
      - mapstyle:/mapstyles
      - /opt/output:/output
    environment:
      - JAVACMD_OPTIONS=-Xmx50G
  mtk2garmin-converter:
    image: teemupel/mtk2garmin-converter:dockerize_converter
    volumes:
      - ./mtk2garmin.conf:/opt/mtk2garmin/mtk2garmin.conf
      - /opt/mtkdata/:/mtkdata
      - /opt/krkdata/:/krkdata
      - additional-data:/additional-data:ro
      - /opt/convertedpbf:/convertedpbf
  merger:
    build: ./merge
    image: localhost:32000/mtk2garmin-merger
    volumes:
      - /opt/convertedpbf:/convertedpbf
      - additional-data:/additional-data:ro
  osxconverter:
    build: ../garminOSXConverter
    image: localhost:32000/osxconverter
    volumes:
      - /opt/output:/output
  additional-data:
    image: localhost:32000/mtk2garmin-additional-data:latest
    volumes:
      - additional-data:/additional-data
  mkgmap:
    image: teemupel/mkgmap
    build: ../mkgmap-converter
    volumes:
      - /opt/convertedpbf:/convertedpbf
      - /opt/splitted:/splitted
      - /opt/output:/output
      - mapstyle:/mapstyles
  mapstyles:
    image: teemupel/mtk2garmin-mapstyles
    build: ../mapstyles
    volumes:
      - mapstyle:/mapstyles
  nsis:
    image: wheatstalk/makensis
    volumes:
      - /opt/output:/output
  site:
    build: ../site
    image: localhost:32000/mtk2garmin-site
    volumes:
      - site:/site
  publish:
    build: ./publish
    image: localhost:32000/mtk2garmin-publish
    volumes:
      - site:/site
      - /opt/output:/output
      - mapstyle:/mapstyles
volumes:
  additional-data:
  mapstyle:
  converted:
  site:
